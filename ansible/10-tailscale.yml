---
# Tailscale configuration playbook - secure fabric setup
- name: "Install and authenticate Tailscale"
  hosts: all
  become: true
  collections:
    - artis3n.tailscale
  tags: ["tailscale", "network"]
  tasks:
    - name: "Wait for tailscale to be ready"
      ansible.builtin.pause:
        seconds: 5
    - name: "Install and configure Tailscale"
      ansible.builtin.include_role:
        name: artis3n.tailscale.machine
      vars:
        tailscale_authkey: "{{ lookup('env', 'vault_tailscale_key') }}"
        tailscale_args: "--accept-routes=false --ssh"

    - name: "Run tailscale_post validation"
      ansible.builtin.include_role:
        name: tailscale_post
