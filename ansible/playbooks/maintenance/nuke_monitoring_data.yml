---
- name: Nuke Monitoring Data
  hosts: proxmox_vms
  become: true
  vars:
    # Adjust this if your stack name in Portainer/Swarm is different
    stack_name: "monitoring" 

  tasks:
    - name: Remove Prometheus Docker Volume (on all nodes)
      command: "docker volume rm {{ stack_name }}_prometheus-data"
      register: vol_rm
      failed_when: 
        - vol_rm.rc != 0 
        - "'not found' not in vol_rm.stderr"
        - "'no such volume' not in vol_rm.stderr"
      changed_when: vol_rm.rc == 0
      ignore_errors: yes

    - name: "Show Completion Message"
      run_once: true
      ansible.builtin.debug:
        msg:
          - "=================================================="
          - "ðŸ§¨ MONITORING DATA NUKED"
          - "   â€¢ Prometheus volumes removed"
          - "=================================================="
