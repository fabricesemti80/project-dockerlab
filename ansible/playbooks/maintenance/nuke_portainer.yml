---
- name: Nuke Portainer
  hosts: dkr-srv-1  # Targeting the node where Portainer is pinned
  become: true
  tasks:
    - name: Remove Portainer stack
      command: docker stack rm portainer
      ignore_errors: yes

    - name: Wait for containers to stop
      pause:
        seconds: 10

    - name: Remove Portainer volume
      command: docker volume rm portainer_portainer_data
      ignore_errors: yes
      register: vol_rm
      failed_when: vol_rm.rc != 0 and "No such volume" not in vol_rm.stderr
    
    - name: "Show Completion Message"
      run_once: true
      ansible.builtin.debug:
        msg:
          - "=================================================="
          - "ðŸ§¨ PORTAINER NUKED"
          - "   â€¢ Stack removed"
          - "   â€¢ Volume deleted"
          - "=================================================="
