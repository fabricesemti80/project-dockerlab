version: '3'

tasks:
  init:
    desc: "Install Ansible Galaxy roles and collections"
    dir: ansible
    cmds:
      - doppler run -- ansible-galaxy install -r requirements.yml
      - doppler run -- ansible-galaxy collection install -r requirements.yml

  plan:
    desc: "Dry run of the site configuration with check and diff"
    dir: ansible
    cmds:
      - doppler run -- ansible-playbook site.yml --check --diff

  apply:
    desc: "Apply the site configuration"
    dir: ansible
    cmds:
      - doppler run -- ansible-playbook site.yml